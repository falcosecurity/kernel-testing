name: Test drivers against a matrix of kernels/distros

on:
  workflow_dispatch:
  schedule:
    - cron: '0 8 * * *' # every day at 8am
    
# Checks if any concurrent jobs under the same pull request or branch are being executed
concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

jobs:
  test-kernels:
    name: build-latest-kernel
    strategy:
      fail-fast: false
      matrix:
        architecture: [X64, ARM64]
    runs-on: [ "self-hosted", "linux", "${{matrix.architecture}}" ]    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
    
      - name: Run kernels tests
        run: |
          ansible-playbook master-playbook.yml
          
      - name: Cleanup
        if: always()
        run: |
          ansible-playbook clean-up.yml
      
      
